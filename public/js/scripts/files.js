AIZ.data={csrf:$('meta[name="csrf-token"]').attr("content"),appUrl:$('meta[name="app-url"]').attr("content"),fileBaseUrl:$('meta[name="file-base-url"]').attr("content")},AIZ.uploader={data:{selectedFiles:[],selectedFilesObject:[],clickedForDelete:null,allFiles:[],multiple:!1,type:"all",next_page_url:null,prev_page_url:null},removeInputValue:function(e,l,a){var t=l.filter((function(l){return l!==e}));t.length>0?$(a).find(".file-amount").html(AIZ.uploader.updateFileHtml(t)):a.find(".file-amount").html(AIZ.local.choose_file),$(a).find(".selected-files").val(t)},removeAttachment:function(){$(document).on("click",".remove-attachment",(function(){var e=$(this).closest(".file-preview-item").data("id"),l=$(this).closest(".file-preview").prev('[data-toggle="aizuploader"]').find(".selected-files").val().split(",").map(Number);AIZ.uploader.removeInputValue(e,l,$(this).closest(".file-preview").prev('[data-toggle="aizuploader"]')),$(this).closest(".file-preview-item").remove()}))},deleteUploaderFile:function(){$(".aiz-uploader-delete").each((function(){$(this).on("click",(function(e){e.preventDefault();var l=$(this).data("id");AIZ.uploader.data.clickedForDelete=l,$("#aizUploaderDelete").modal("show"),$(".aiz-uploader-confirmed-delete").on("click",(function(e){if(e.preventDefault(),1===e.detail){var l=AIZ.uploader.data.allFiles[AIZ.uploader.data.allFiles.findIndex((e=>e.id===AIZ.uploader.data.clickedForDelete))];$.ajax({url:AIZ.data.appUrl+"/aiz-uploader/destroy/"+AIZ.uploader.data.clickedForDelete,type:"DELETE",dataType:"JSON",data:{id:AIZ.uploader.data.clickedForDelete,_method:"DELETE",_token:AIZ.data.csrf},success:function(){AIZ.uploader.data.selectedFiles=AIZ.uploader.data.selectedFiles.filter((function(e){return e!==AIZ.uploader.data.clickedForDelete})),AIZ.uploader.data.selectedFilesObject=AIZ.uploader.data.selectedFilesObject.filter((function(e){return e!==l})),AIZ.uploader.updateUploaderSelected(),AIZ.uploader.getAllUploads(AIZ.data.appUrl+"/aiz-uploader/get_uploaded_files"),AIZ.uploader.data.clickedForDelete=null,$("#aizUploaderDelete").modal("hide")}})}}))}))}))},uploadSelect:function(){$(".aiz-uploader-select").each((function(){var e=$(this);e.on("click",(function(l){var a=$(this).data("value"),t=AIZ.uploader.data.allFiles[AIZ.uploader.data.allFiles.findIndex((e=>e.id===a))];e.closest(".aiz-file-box-wrap").toggleAttr("data-selected","true","false"),AIZ.uploader.data.multiple||e.closest(".aiz-file-box-wrap").siblings().attr("data-selected","false"),AIZ.uploader.data.selectedFiles.includes(a)?(AIZ.uploader.data.selectedFiles=AIZ.uploader.data.selectedFiles.filter((function(e){return e!==a})),AIZ.uploader.data.selectedFilesObject=AIZ.uploader.data.selectedFilesObject.filter((function(e){return e!==t}))):(AIZ.uploader.data.multiple||(AIZ.uploader.data.selectedFiles=[],AIZ.uploader.data.selectedFilesObject=[]),AIZ.uploader.data.selectedFiles.push(a),AIZ.uploader.data.selectedFilesObject.push(t)),AIZ.uploader.addSelectedValue(),AIZ.uploader.updateUploaderSelected()}))}))},updateFileHtml:function(e){var l="";if(e.length>1)l=AIZ.local.files_selected;else l=AIZ.local.file_selected;return e.length+" "+l},updateUploaderSelected:function(){$(".aiz-uploader-selected").html(AIZ.uploader.updateFileHtml(AIZ.uploader.data.selectedFiles))},clearUploaderSelected:function(){$(".aiz-uploader-selected-clear").on("click",(function(){AIZ.uploader.data.selectedFiles=[],AIZ.uploader.addSelectedValue(),AIZ.uploader.addHiddenValue(),AIZ.uploader.resetFilter(),AIZ.uploader.updateUploaderSelected(),AIZ.uploader.updateUploaderFiles()}))},resetFilter:function(){$('[name="aiz-uploader-search"]').val(""),$('[name="aiz-show-selected"]').prop("checked",!1),$('[name="aiz-uploader-sort"] option[value=newest]').prop("selected",!0)},getAllUploads:function(e,l=null,a=null){$(".aiz-uploader-all").html('<div class="align-items-center d-flex h-100 justify-content-center w-100"><div class="spinner-border" role="status"></div></div>');var t={};null!=l&&l.length>0&&(t.search=l),null!=a&&a.length>0?t.sort=a:t.sort="newest",$.get(e,t,(function(e,l){"string"==typeof e&&(e=JSON.parse(e)),AIZ.uploader.data.allFiles=e.data,AIZ.uploader.allowedFileType(),AIZ.uploader.addSelectedValue(),AIZ.uploader.addHiddenValue(),AIZ.uploader.updateUploaderFiles(),null!=e.next_page_url?(AIZ.uploader.data.next_page_url=e.next_page_url,$("#uploader_next_btn").removeAttr("disabled")):$("#uploader_next_btn").attr("disabled",!0),null!=e.prev_page_url?(AIZ.uploader.data.prev_page_url=e.prev_page_url,$("#uploader_prev_btn").removeAttr("disabled")):$("#uploader_prev_btn").attr("disabled",!0)}))},showSelectedFiles:function(){$('[name="aiz-show-selected"]').on("change",(function(){$(this).is(":checked")?AIZ.uploader.data.allFiles=AIZ.uploader.data.selectedFilesObject:AIZ.uploader.getAllUploads(AIZ.data.appUrl+"/aiz-uploader/get_uploaded_files"),AIZ.uploader.updateUploaderFiles()}))},searchUploaderFiles:function(){$('[name="aiz-uploader-search"]').on("keyup",(function(){var e=$(this).val();AIZ.uploader.getAllUploads(AIZ.data.appUrl+"/aiz-uploader/get_uploaded_files",e,$('[name="aiz-uploader-sort"]').val())}))},sortUploaderFiles:function(){$('[name="aiz-uploader-sort"]').on("change",(function(){var e=$(this).val();AIZ.uploader.getAllUploads(AIZ.data.appUrl+"/aiz-uploader/get_uploaded_files",$('[name="aiz-uploader-search"]').val(),e)}))},addSelectedValue:function(){for(var e=0;e<AIZ.uploader.data.allFiles.length;e++)AIZ.uploader.data.selectedFiles.includes(AIZ.uploader.data.allFiles[e].id)?AIZ.uploader.data.allFiles[e].selected=!0:AIZ.uploader.data.allFiles[e].selected=!1},addHiddenValue:function(){for(var e=0;e<AIZ.uploader.data.allFiles.length;e++)AIZ.uploader.data.allFiles[e].aria_hidden=!1},allowedFileType:function(){if("all"!==AIZ.uploader.data.type){let e=AIZ.uploader.data.type.split(",");AIZ.uploader.data.allFiles=AIZ.uploader.data.allFiles.filter((function(l){return e.includes(l.type)}))}},updateUploaderFiles:function(){$(".aiz-uploader-all").html('<div class="align-items-center d-flex h-100 justify-content-center w-100"><div class="spinner-border" role="status"></div></div>');var e=AIZ.uploader.data.allFiles;setTimeout((function(){if($(".aiz-uploader-all").html(null),e.length>0)for(var l=0;l<e.length;l++){var a="";a="image"===e[l].type?'<img src="'+AIZ.data.fileBaseUrl+e[l].file_name+'" class="img-fit">':'<i class="la la-file-text"></i>';var t='<div class="aiz-file-box-wrap" aria-hidden="'+e[l].aria_hidden+'" data-selected="'+e[l].selected+'"><div class="aiz-file-box"><div class="card card-file aiz-uploader-select" title="'+e[l].file_original_name+"."+e[l].extension+'" data-value="'+e[l].id+'"><div class="card-file-thumb">'+a+'</div><div class="card-body"><h6 class="d-flex"><span class="text-truncate title">'+e[l].file_original_name+'</span><span class="ext flex-shrink-0">.'+e[l].extension+"</span></h6><p>"+AIZ.extra.bytesToSize(e[l].file_size)+"</p></div></div></div></div>";$(".aiz-uploader-all").append(t)}else $(".aiz-uploader-all").html('<div class="align-items-center d-flex h-100 justify-content-center w-100 nav-tabs"><div class="text-center"><h3>No files found</h3></div></div>');AIZ.uploader.uploadSelect(),AIZ.uploader.deleteUploaderFile()}),300)},inputSelectPreviewGenerate:function(e){e.find(".selected-files").val(AIZ.uploader.data.selectedFiles),e.next(".file-preview").html(null),AIZ.uploader.data.selectedFiles.length>0?$.post(AIZ.data.appUrl+"/aiz-uploader/get_file_by_ids",{_token:AIZ.data.csrf,ids:AIZ.uploader.data.selectedFiles.toString()},(function(l){if(e.next(".file-preview").html(null),l.length>0){e.find(".file-amount").html(AIZ.uploader.updateFileHtml(l));for(var a=0;a<l.length;a++){var t="";t="image"===l[a].type?'<img src="'+l[a].file_name+'" class="img-fit">':'<i class="la la-file-text"></i>';var d='<div class="d-flex justify-content-between align-items-center mt-2 file-preview-item" data-id="'+l[a].id+'" title="'+l[a].file_original_name+"."+l[a].extension+'"><div class="align-items-center align-self-stretch d-flex justify-content-center thumb">'+t+'</div><div class="col body"><h6 class="d-flex"><span class="text-truncate title">'+l[a].file_original_name+'</span><span class="flex-shrink-0 ext">.'+l[a].extension+"</span></h6><p>"+AIZ.extra.bytesToSize(l[a].file_size)+'</p></div><div class="remove"><button class="btn btn-sm btn-link remove-attachment" type="button"><i class="la la-close"></i></button></div></div>';e.next(".file-preview").append(d)}}else e.find(".file-amount").html(AIZ.local.choose_file)})):e.find(".file-amount").html(AIZ.local.choose_file)},editorImageGenerate:function(e){if(AIZ.uploader.data.selectedFiles.length>0)for(var l=0;l<AIZ.uploader.data.selectedFiles.length;l++){var a=AIZ.uploader.data.allFiles.findIndex((e=>e.id===AIZ.uploader.data.selectedFiles[l])),t="";"image"===AIZ.uploader.data.allFiles[a].type&&(t='<img src="'+AIZ.data.fileBaseUrl+AIZ.uploader.data.allFiles[a].file_name+'">',e[0].insertHTML(t))}},dismissUploader:function(){$("#aizUploaderModal").on("hidden.bs.modal",(function(){$(".aiz-uploader-backdrop").remove(),$("#aizUploaderModal").remove()}))},trigger:function(e=null,l="",a="all",t="",d=!1,i=null){e=$(e);var o=t;AIZ.uploader.data.selectedFiles=""!==o?o.split(",").map(Number):[],void 0!==a&&a.length>0&&(AIZ.uploader.data.type=a),AIZ.uploader.data.multiple=!!d,$.post(AIZ.data.appUrl+"/aiz-uploader",{_token:AIZ.data.csrf},(function(a){$("body").append(a),$("#aizUploaderModal").modal("show"),AIZ.plugins.aizUppy(),AIZ.uploader.getAllUploads(AIZ.data.appUrl+"/aiz-uploader/get_uploaded_files",null,$('[name="aiz-uploader-sort"]').val()),AIZ.uploader.updateUploaderSelected(),AIZ.uploader.clearUploaderSelected(),AIZ.uploader.sortUploaderFiles(),AIZ.uploader.searchUploaderFiles(),AIZ.uploader.showSelectedFiles(),AIZ.uploader.dismissUploader(),$("#uploader_next_btn").on("click",(function(){null!=AIZ.uploader.data.next_page_url&&($('[name="aiz-show-selected"]').prop("checked",!1),AIZ.uploader.getAllUploads(AIZ.uploader.data.next_page_url))})),$("#uploader_prev_btn").on("click",(function(){null!=AIZ.uploader.data.prev_page_url&&($('[name="aiz-show-selected"]').prop("checked",!1),AIZ.uploader.getAllUploads(AIZ.uploader.data.prev_page_url))})),$(".aiz-uploader-search i").on("click",(function(){$(this).parent().toggleClass("open")})),$('[data-toggle="aizUploaderAddSelected"]').on("click",(function(){"input"===l?AIZ.uploader.inputSelectPreviewGenerate(e):"direct"===l&&i(AIZ.uploader.data.selectedFiles),$("#aizUploaderModal").modal("hide")}))}))},initForInput:function(){$(document).on("click",'[data-toggle="aizuploader"]',(function(e){if(1===e.detail){var l=$(this),a=l.data("multiple"),t=l.data("type"),d=l.find(".selected-files").val();a=a||"",t=t||"",d=d||"",AIZ.uploader.trigger(this,"input",t,d,a)}}))},previewGenerate:function(){$('[data-toggle="aizuploader"]').each((function(){var e=$(this),l=e.find(".selected-files").val();""!=l&&$.post(AIZ.data.appUrl+"/aiz-uploader/get_file_by_ids",{_token:AIZ.data.csrf,ids:l},(function(l){if(e.next(".file-preview").html(null),l.length>0){e.find(".file-amount").html(AIZ.uploader.updateFileHtml(l));for(var a=0;a<l.length;a++){var t="";t="image"===l[a].type?'<img src="'+l[a].file_name+'" class="img-fit">':'<i class="la la-file-text"></i>';var d='<div class="d-flex justify-content-between align-items-center mt-2 file-preview-item" data-id="'+l[a].id+'" title="'+l[a].file_original_name+"."+l[a].extension+'"><div class="align-items-center align-self-stretch d-flex justify-content-center thumb">'+t+'</div><div class="col body"><h6 class="d-flex"><span class="text-truncate title">'+l[a].file_original_name+'</span><span class="ext flex-shrink-0">.'+l[a].extension+"</span></h6><p>"+AIZ.extra.bytesToSize(l[a].file_size)+'</p></div><div class="remove"><button class="btn btn-sm btn-link remove-attachment" type="button"><i class="la la-close"></i></button></div></div>';e.next(".file-preview").append(d)}}else e.find(".file-amount").html(AIZ.local.choose_file)}))}))}};
